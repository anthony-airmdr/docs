---
title: "AWS Security Token Service (STS)"
description: "AWS Security Token Service (STS) is a web service that enables you to request temporary, limited-privilege security credentials for IAM users or federated users. These temporary credentials can be used to access AWS resources securely without creating long-term IAM credentials."
---

### **Setup AWS Security Token Service (STS)**

Setting up AWS STS typically involves assuming roles securely across different AWS accounts or services. Here’s how you can set it up:

<Steps>
  <Step title="Enable AWS STS">
    AWS STS is enabled by default for most AWS Regions. However, you can verify or enable it through the AWS Management Console:

    1. **Sign in** to the AWS Management Console →  [AWS IAM Console](https://console.aws.amazon.com/iam/).
    2. Click on **Account Settings**.
    3. Check if AWS STS is enabled for the necessary regions.
  </Step>
  <Step title="Create an IAM Role for STS">
    1. Go to the [AWS IAM Console](https://console.aws.amazon.com/iam/).
    2. Click on **Roles** in the left navigation panel.
    3. Click the **Create role** button.
  </Step>
  <Step title="Enable GuardDuty Findings Export to Amazon S3">
    **Pre-requisites**

    <Check>
      Ensure **GuardDuty is enabled** in your AWS account.
    </Check>
    <Check>
      An **Amazon S3 bucket** exists for storing findings
    </Check>
    <Check>
      Proper **IAM permissions** for GuardDuty to write to the S3 bucket.
    </Check>
    1. Go to your [AWS GuardDuty Console](https://console.aws.amazon.com/guardduty/).
    2. In the settings, enable the export of findings to your S3 bucket.
    3. Specify the S3 bucket ARN and KMS key ARN of the same region.

       <Warning>
         Issues you can run into:
         - Principal did not have access to the KMS key.
       </Warning>
  </Step>
  <Step title="Set Up an IAM Role for API Access in AWS">
    If you need to grant **secure API access** to AWS services (e.g., EC2, Lambda, or third-party applications), you must create an **IAM role** with the right permissions.

    <Steps>
      <Step title="Create an IAM Role">
        - **Sign in** to the [AWS IAM Console](https://console.aws.amazon.com/iam/).
        - Click **"Roles"** → **"Create Role"**.
        - **Select a trusted entity**:
          - If AWS services (e.g., EC2, Lambda) need API access → Choose **AWS Service**.
          - If a third-party app needs access → Choose **Web Identity or OpenID Connect**.
          - If another AWS account needs access → Choose **Another AWS Account**.
        - Click **Next**.
      </Step>
      <Step title="Attach API Permissions">
        Choose a predefined **AWS Managed Policy** or create a custom one:

        - **Full API Access** → `AdministratorAccess` (Not recommended for security).
        - **Read-Only API Access** → `ReadOnlyAccess`.
        - **GuardDuty API Access** → `AmazonGuardDutyFullAccess`.
      </Step>
      <Step title="Create User and Retrieve Credentials">
        1. Review the permissions and user details.
        2. Create the user.
        3. Download the .csv file containing the **access key ID** and **secret access key**

           <Warning>
             Securely save and share these credentials with the AirMDR operations team to allow monitoring.
           </Warning>
      </Step>
    </Steps>
  </Step>
</Steps>

### Setting Up AWS CloudTrail for Security & Auditing

AWS **CloudTrail** is a service that logs all API actions taken in your AWS account. It helps with **security auditing, compliance, and operational troubleshooting**.

1. **Sign in** to the same [AWS IAM Console](https://console.aws.amazon.com/iam/) created for AWS GuardDuty.
2. Click Permissions → **Add Permissions**.\
   ![images/AWS3.png](/images/AWS3.png)
3. Select the Permission options → **Attach policies directly**.
4. Search for the keyword "CloudTrial" and select **AWSCloudTrail_ReadOnlyAccess**.\
   ![images/AWS4.png](/images/AWS4.png)
5. Review the Permission summary.
6. Click **Add Permissions**.\
   ![images/AWS5.png](/images/AWS5.png)

### Mapping AWS CloudTrail Logs into Amazon Athena

**Pre-requisites**

<Check>
  **CloudTrail is enabled** and it logs to an **S3 bucket**.
</Check>

<Check>
  **Athena is enabled** in your AWS account.
</Check>

1. Open the Cloud trail in AWS and then Select **Event History**.
2. Select **Create Athena Table** (top right corner).
3. A pop-up opens, and select the S3 bucket in the storage location.
4. Click **Create Table**.

### Configure AWS in the AirMDR Integrations Dashboard

1. Navigate to [AirMDR](https://app.airmdr.com/auth/login), provide the credentials, and click **Login.**

   ![](/images/Datadog11.png)
2. Navigate to the AirMDR Integrations Dashboard in the left navigation pane and select **Integrations.**\
   ![images/Duo7.png](/images/Duo7.png)
3. Use the search option, enter the keyword "**Amazon Web Services**", select the **Connections** tab, and click the **+ Create** icon.\
   ![images/AWS1.png](/images/AWS1.png)
4. Enter the generated **access_key, secret_key, and **provide the **region_name** for which this connection is to be used in the Authentication Details field params, and click **Create.**\
   ![images/AWS2.png](/images/AWS2.png)